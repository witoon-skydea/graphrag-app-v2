# คำสั่งงานเร่งด่วน: GraphRAG Phase 1 - แก้ไขและปรับปรุงคุณภาพโค้ด

## ข้อมูลทั่วไป
- **โปรเจค**: GraphRAG 
- **สถานะปัจจุบัน**: ผ่านการตรวจสอบคุณภาพ (QA) - พบประเด็นที่ต้องแก้ไขเล็กน้อย
- **เป้าหมายเฟส 1**: แก้ไขปัญหาเร่งด่วนและเพิ่มความแข็งแกร่งของระบบ
- **กำหนดเวลา**: 2 สัปดาห์ (เริ่ม 21 เมษายน - 5 พฤษภาคม 2568)
- **การประชุมติดตาม**: สัปดาห์ละ 2 ครั้ง (วันอังคารและวันศุกร์)

## สรุปประเด็นที่ต้องแก้ไข

จากรายงาน QA พบประเด็นที่ต้องแก้ไข 4 เรื่องหลักที่ต้องดำเนินการในเฟส 1:

1. **ความไม่สอดคล้องของพารามิเตอร์** ในไฟล์ `entity_extractor.py` และ `relationship_identifier.py`
2. **ปัญหา Circular Imports** ในไฟล์ `graph_rag_engine.py` และโมดูลที่เกี่ยวข้อง
3. **การจัดการข้อผิดพลาดยังไม่ครอบคลุม** ในหลายส่วนของโค้ด
4. **ขาดการทดสอบที่เป็นระบบ** (ไม่มีโฟลเดอร์ `tests/`)

## งานที่ต้องดำเนินการ

### 1. แก้ไขความไม่สอดคล้องของพารามิเตอร์
**ผู้รับผิดชอบ**: ทีม Backend (Main Developer)
**กำหนดส่ง**: 26 เมษายน 2568

**รายละเอียดงาน**:
- แก้ไขความไม่สอดคล้องใน `entity_extractor.py`:
  - ปรับปรุงพารามิเตอร์ `entity_types` ในคลาส `EntityExtractor` ให้มีความสอดคล้องกับการใช้งานใน `KnowledgeGraphBuilder`
  - เพิ่มเอกสารอธิบายชัดเจนว่าพารามิเตอร์ใดมีผลเหนือกว่ากัน เมื่อมีการกำหนดค่าที่ซ้ำซ้อน

- แก้ไขความไม่สอดคล้องใน `relationship_identifier.py`:
  - ปรับปรุงการตั้งชื่อตัวแปรให้สอดคล้องกันทั้งคลาส เช่น ใช้ `confidence_threshold` แทนการใช้ `threshold` และ `min_confidence` สลับกันไปมา
  - ปรับปรุงพารามิเตอร์และการเรียกใช้ให้สอดคล้องกัน

**ผลลัพธ์ที่คาดหวัง**:
- โค้ดมีความสอดคล้องในการใช้พารามิเตอร์
- มีเอกสารอธิบายชัดเจนเกี่ยวกับการทำงานของพารามิเตอร์

### 2. แก้ไขปัญหา Circular Imports
**ผู้รับผิดชอบ**: ทีม Backend (Senior Developer)
**กำหนดส่ง**: 26 เมษายน 2568

**รายละเอียดงาน**:
- แก้ไขปัญหา circular imports ระหว่างโมดูลที่พึ่งพากัน โดยเฉพาะในไฟล์ `graph_rag_engine.py` และโมดูลอื่นๆ ที่เกี่ยวข้อง
- ใช้เทคนิคต่อไปนี้ในการแก้ไข:
  - ย้าย imports ไปในฟังก์ชันที่ใช้งานจริง (เพื่อทำ lazy import)
  - ปรับโครงสร้างการ import เพื่อลดการพึ่งพากันระหว่างโมดูล
  - ในกรณีจำเป็น ให้พิจารณาการใช้ `typing.TYPE_CHECKING` สำหรับ type hints เพื่อลดปัญหา circular imports

**ผลลัพธ์ที่คาดหวัง**:
- ไม่มี circular imports ในโค้ด
- โค้ดสามารถรันและ import ได้โดยไม่มีข้อผิดพลาด

### 3. เพิ่มการจัดการข้อผิดพลาด
**ผู้รับผิดชอบ**: ทีม Backend (All Developers)
**กำหนดส่ง**: 28 เมษายน 2568

**รายละเอียดงาน**:
- ปรับปรุง error handling ในไฟล์ `VectorDBClient` โดยเพิ่มการตรวจสอบว่า import สำเร็จหรือไม่ก่อนใช้ `get_valid_uuid`
- ตรวจสอบและเพิ่มการจัดการค่า None ในฟังก์ชันที่อาจได้รับค่า None จากการเรียกใช้ API หรือการค้นหาข้อมูล
- เพิ่ม try-except blocks ในส่วนที่ติดต่อกับ API ภายนอกอย่างครอบคลุม (OpenAI, Anthropic, Gemini, Ollama)
- ใช้ logging ให้เหมาะสมในทุกกรณีของข้อผิดพลาด
- พิจารณาการเพิ่ม validation ในพารามิเตอร์ที่สำคัญเพื่อป้องกันข้อผิดพลาด

**รายการไฟล์ที่ต้องตรวจสอบ**:
- `/src/graphrag_engine/vector_db/weaviate_client.py`
- `/src/graphrag_engine/knowledge_graph/entity_extractor.py`
- `/src/graphrag_engine/knowledge_graph/relationship_identifier.py`
- `/src/graphrag_engine/graph_rag_engine.py`

**ผลลัพธ์ที่คาดหวัง**:
- มีการจัดการข้อผิดพลาดในทุกจุดที่อาจเกิดปัญหา
- ระบบสามารถรับมือกับการล้มเหลวของการเรียกใช้ API ภายนอก
- มีข้อความ logging ที่ชัดเจนสำหรับการแก้ไขปัญหา

### 4. พัฒนาระบบการทดสอบ
**ผู้รับผิดชอบ**: ทีม Backend (Test Engineer) และ ทีม DevOps
**กำหนดส่ง**: 5 พฤษภาคม 2568

**รายละเอียดงาน**:
- สร้างโฟลเดอร์ `tests/` ในโปรเจค
- พัฒนา unit tests สำหรับแต่ละโมดูล:
  - `tests/knowledge_graph/` - ทดสอบโมดูล knowledge graph
  - `tests/vector_db/` - ทดสอบโมดูล vector database
  - `tests/document_processing/` - ทดสอบโมดูล document processing
  - `tests/embedding/` - ทดสอบโมดูล embedding
  - `tests/integration/` - ทดสอบการทำงานร่วมกันของโมดูลต่างๆ

- ใช้ pytest สำหรับการทดสอบ
- พัฒนา test fixtures และ mock objects เพื่อทดสอบโดยไม่ต้องเชื่อมต่อกับบริการภายนอก (Ollama, Weaviate, OpenAI, ฯลฯ)
- สร้างไฟล์ `conftest.py` สำหรับการตั้งค่า test environment
- ตั้งค่า GitHub Actions หรือ CI/CD pipeline สำหรับรันการทดสอบอัตโนมัติ

**Test cases ที่ต้องพัฒนา**:
1. Unit tests สำหรับ EntityExtractor
2. Unit tests สำหรับ RelationshipIdentifier
3. Unit tests สำหรับ NodeRegistry
4. Unit tests สำหรับ VectorDBClient
5. Unit tests สำหรับ GraphRAGEngine
6. Integration tests สำหรับการทำงานร่วมกันของทุกโมดูล

**ผลลัพธ์ที่คาดหวัง**:
- มี test coverage อย่างน้อย 80% สำหรับไฟล์ที่สำคัญ
- การทดสอบทั้งหมดต้องผ่าน (pass)
- มีระบบ CI/CD ที่ทดสอบโค้ดอัตโนมัติเมื่อมีการเปลี่ยนแปลง

### 5. ปรับปรุงเอกสาร
**ผู้รับผิดชอบ**: ทีม Backend (Documentation Lead)
**กำหนดส่ง**: 3 พฤษภาคม 2568

**รายละเอียดงาน**:
- ปรับปรุง README.md ให้มีข้อมูลที่ครบถ้วน:
  - วิธีการติดตั้งและตั้งค่าระบบ
  - วิธีการใช้งานพื้นฐาน
  - ตัวอย่างการใช้งานสำหรับแต่ละฟีเจอร์
  - คำอธิบายโครงสร้างโปรเจค

- เพิ่มคำอธิบาย (docstrings) ในฟังก์ชันที่ซับซ้อน
- สร้างเอกสาร API ด้วย Sphinx หรือเครื่องมืออื่นที่เหมาะสม
- อัพเดทเอกสารออกแบบระบบให้สอดคล้องกับการเปลี่ยนแปลงล่าสุด

**ผลลัพธ์ที่คาดหวัง**:
- มีเอกสารที่ครบถ้วนสำหรับการใช้งานโปรเจค
- มีเอกสาร API ที่สร้างจาก docstrings
- มีเอกสารออกแบบระบบที่อัพเดทล่าสุด

## กำหนดการและการส่งมอบ

| วันที่ | งานที่ต้องส่งมอบ |
|-------|-----------------|
| 26 เม.ย. 2568 | - แก้ไขความไม่สอดคล้องของพารามิเตอร์<br>- แก้ไขปัญหา Circular Imports |
| 28 เม.ย. 2568 | - เพิ่มการจัดการข้อผิดพลาด |
| 3 พ.ค. 2568 | - ปรับปรุงเอกสาร |
| 5 พ.ค. 2568 | - พัฒนาระบบการทดสอบ<br>- รวมทุกส่วนและ code review ท้ายสุด |

## เกณฑ์ความสำเร็จ

โปรเจคจะถือว่าผ่านเฟส 1 เมื่อ:
1. โค้ดไม่มีปัญหาความไม่สอดคล้องของพารามิเตอร์
2. โค้ดไม่มีปัญหา circular imports
3. มีการจัดการข้อผิดพลาดที่ครอบคลุมทุกกรณี
4. มีระบบการทดสอบที่ครอบคลุมอย่างน้อย 80% ของโค้ด
5. มีเอกสารที่ครบถ้วนสำหรับการใช้งาน

## การรายงานความคืบหน้า

- ทุกคนต้องอัพเดทความคืบหน้าในการประชุมทีมทุกวันอังคารและวันศุกร์
- สร้าง Pull Request (PR) สำหรับแต่ละงานที่เสร็จ เพื่อให้ทีมตรวจสอบก่อน merge
- ใช้ issue tracker เพื่อติดตามความคืบหน้าและปัญหาที่พบ

---

*หากมีข้อสงสัยหรือพบปัญหาเพิ่มเติมระหว่างการพัฒนา กรุณาแจ้ง Project Manager ทันที*